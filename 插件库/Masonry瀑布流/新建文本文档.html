<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    body {
      height: auto;
    }

    .grid-item img {
      background-color: #ccc;
      width: 100%;
    }

    .grid-item {
      width: calc((100% - 40px) / 5);
    }
  </style>
</head>

<body>
  <div id="grid">
    <div class="grid-item">
      <img src="https://t11.baidu.com/it/u=3316063573,415163816&fm=76" alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img src="https://t11.baidu.com/it/u=3316063573,415163816&fm=76" alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img src="https://t11.baidu.com/it/u=3316063573,415163816&fm=76" alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img src="https://t11.baidu.com/it/u=3316063573,415163816&fm=76" alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.baidu.com/73F1bjeh1BF3odCf/it/u=2181479490,3865945178&fm=85&s=BD81E91794604D0112E1517303003070"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.baidu.com/73F1bjeh1BF3odCf/it/u=2181479490,3865945178&fm=85&s=BD81E91794604D0112E1517303003070"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.baidu.com/73F1bjeh1BF3odCf/it/u=2181479490,3865945178&fm=85&s=BD81E91794604D0112E1517303003070"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.baidu.com/73F1bjeh1BF3odCf/it/u=2181479490,3865945178&fm=85&s=BD81E91794604D0112E1517303003070"
        alt="">
    </div>
    <div class="grid-item">
      <img
        src="https://ss0.bdstatic.com/-0U0b8Sm1A5BphGlnYG/kmarketingadslogo/8af969961a3cb62bda5128c18ac9afd2_250_250.jpg"
        alt="">
    </div>
  </div>
  <div id="footer">1111</div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
  <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script src="./../waypoints/jquery.waypoints.js"></script>
  <script>
    $(function (params) {
      $('#grid').masonry({
        columnWidth: '.grid-item',
        itemSelector: '.grid-item',
        gutter: 10,
        percentPosition: true,
        horizontalOrder: true,
        originLeft: true,
        originTop: true
      });



      // var docViewTop = $(window).scrollTop();
      // var docViewBottom = docViewTop + $(window).height();
      // var elemTop = $(elem).offset().top;
      var waypoint = new Waypoint({
        element: document.getElementById('footer'),
        handler: function (direction) {
            if (direction === 'up') return
            var elems = []
            var fragment = document.createDocumentFragment();
            var arr = []
            for (var i = 0; i < 20; i++) {
              var string =
                "https://public-resource-oss.oss-cn-shanghai.aliyuncs.com/hq/20190611/1/145bc3dccad34915a4e7bb7d43cec6b0.png,https://public-resource-oss.oss-cn-shanghai.aliyuncs.com/hq/20190611/30/f2a1711d96c6488ca27ea16ed6d8689c.png,https://public-resource-oss.oss-cn-shanghai.aliyuncs.com/hq/20190611/1/c523c0c343064a74844db47e79d73696.gif"
              var array = string.split(","); //转化为数组
              var value = array[Math.round(Math.random() * (array.length - 1))]; //随机抽取一个值
              var items = $(
                `<div class="grid-item"><img src="${value}"></div>`
              )
              $('#grid').append(items).masonry('appended', items)
              $('#grid').imagesLoaded(function () {
                //加载完图片后，会实现自动重新排列。【这里是重点】

                $('#grid').masonry();
                Waypoint.refreshAll()

              }); 
            }
           
           
          console.log(direction);
        },
        offset: 'bottom-in-view'
      })
    })
  </script>
</body>

</html>